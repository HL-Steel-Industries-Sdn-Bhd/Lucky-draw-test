<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Lucky Draw</title>

<style>
body {
  font-family: Arial;
  text-align: center;
  background: #f5f5f5;
}

#wheel-container {
  position: relative;
  width: 300px;
  height: 300px;
  margin: 40px auto;
}

#wheel {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border: 6px solid #333;
  background: conic-gradient(
    gold 0deg 90deg,
    silver 90deg 180deg,
    bronze 180deg 270deg,
    pink 270deg 360deg
  );
  transition: transform 3s cubic-bezier(0.25, 0.1, 0.25, 1);
}

#pointer {
  position: absolute;
  top: -20px;
  left: 50%;
  width: 0;
  height: 0;
  transform: translateX(-50%);
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  border-bottom: 20px solid red;
}

button {
  padding: 12px 30px;
  font-size: 18px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.start {
  background: #f4b6b6;
}

.stop {
  background: #b6d9f4;
}

#result {
  margin-top: 20px;
  font-size: 20px;
  min-height: 30px;
}
</style>
</head>

<body>

<h2>Lucky Draw</h2>

<div id="wheel-container">
  <div id="pointer"></div>
  <div id="wheel"></div>
</div>

<button id="btn" class="start">开始</button>

<div id="result"></div>

<!-- hidden form -->
<form id="logForm" target="hiddenFrame"
      method="POST"
      action="https://script.google.com/macros/s/AKfycbyXVIuHrlCdRSw3g0LIb9ntEPkbvYYn6fFoPamsCfwZdZ00wVyWp96SHbI8afyLdir0/exec">
  <input type="hidden" name="prize" id="prizeInput">
</form>
<iframe name="hiddenFrame" style="display:none;"></iframe>

<script>
const wheel = document.getElementById("wheel");
const btn = document.getElementById("btn");
const result = document.getElementById("result");

let spinning = false;
let currentRotation = 0;
let selectedPrize = "";

const prizeAngles = {
  "一等奖": [0, 90],
  "二等奖": [90, 180],
  "三等奖": [180, 270],
  "再来一次": [270, 360]
};

function drawPrize() {
  const r = Math.random();
  if (r < 0.10) return "一等奖";
  if (r < 0.30) return "二等奖";
  if (r < 0.60) return "三等奖";
  return "再来一次";
}

function getTargetAngle(prize) {
  const [min, max] = prizeAngles[prize];
  return Math.random() * (max - min) + min;
}

btn.onclick = () => {
  if (!spinning) {
    spinning = true;
    result.textContent = "";
    btn.textContent = "停止";
    btn.className = "stop";

    selectedPrize = drawPrize();
    const angle = getTargetAngle(selectedPrize);
    const finalRotation = currentRotation + 360 * 5 + angle;

    wheel.style.transform = `rotate(${finalRotation}deg)`;
    currentRotation = finalRotation;

    setTimeout(() => {
      result.textContent = "你获得：" + selectedPrize;
      document.getElementById("prizeInput").value = selectedPrize;
      document.getElementById("logForm").submit();

      btn.textContent = "开始";
      btn.className = "start";
      spinning = false;
    }, 3000);
  }
};
</script>

</body>
</html>
